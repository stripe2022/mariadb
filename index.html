<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inventario → PDF</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
  <style>
    :root {
      --bg: #0b1220;
      --card: #121a2b;
      --muted: #9fb0d3;
      --text: #e9f0ff;
      --accent: #4f8cff;
      --accent2: #22c55e;
      --danger: #ef4444;
      --border: #22304d;
    }
    body {
      margin: 0; padding: 24px; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, Helvetica, sans-serif;
      background: radial-gradient(1200px 800px at 20% -20%, rgba(79,140,255,.15), transparent 60%),
                  radial-gradient(1200px 800px at 120% 20%, rgba(34,197,94,.12), transparent 60%),
                  var(--bg);
      color: var(--text);
    }
    .container { max-width: 1100px; margin: 0 auto; display: grid; gap: 18px; }
    h1 { font-size: 1.35rem; margin: 0; }
    .card { background: #0f172a; border: 1px solid var(--border); padding: 16px; border-radius: 14px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px 12px; border-bottom: 1px solid var(--border); }
    th { text-align: left; color: var(--muted); }
    td.num { text-align: right; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Subir CSV → Generar PDF de Inventario</h1>
    <input id="fileInput" type="file" accept=".csv,.tsv,.txt" />
    <button id="btnPdf" disabled>Generar PDF</button>
    <div id="preview"></div>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const btnPdf = document.getElementById('btnPdf');
    const preview = document.getElementById('preview');

    let parsed = { headers: [], rows: [], dateText: '' };

    fileInput.addEventListener('change', () => {
      const file = fileInput.files[0];
      if (!file) return;
      Papa.parse(file, {
        header: true,
        skipEmptyLines: true,
        complete: (res) => {
          parsed.headers = res.meta.fields;
          parsed.rows = res.data;
          buildPreview();
          btnPdf.disabled = false;
        }
      });
    });

    function buildPreview() {
      preview.innerHTML = '';
      const table = document.createElement('table');
      const thead = document.createElement('thead');
      const trh = document.createElement('tr');
      parsed.headers.forEach(h => {
        const th = document.createElement('th'); th.textContent = h; trh.appendChild(th);
      });
      thead.appendChild(trh);
      table.appendChild(thead);
      const tbody = document.createElement('tbody');
      parsed.rows.slice(0,50).forEach(r => {
        const tr = document.createElement('tr');
        parsed.headers.forEach(h => {
          const td = document.createElement('td');
          let val = r[h];
          if (h.toLowerCase().includes('precio')) {
            td.textContent = '$' + val;
            td.classList.add('num');
          } else if (h.toLowerCase().includes('costo')) {
            td.textContent = '$' + val;
            td.classList.add('num');
          } else if (h.toLowerCase().includes('stock')) {
            td.textContent = val;
            td.classList.add('num');
          } else {
            td.textContent = val;
          }
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      preview.appendChild(table);
    }

    btnPdf.addEventListener('click', () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const headers = parsed.headers.map(h => ({ content: h, styles: { halign: h.match(/costo|precio|stock/i) ? 'right' : 'left' } }));
      const body = parsed.rows.map(r => parsed.headers.map(h => {
        let val = r[h];
        if (h.toLowerCase().includes('precio') || h.toLowerCase().includes('costo')) {
          return '$' + val;
        } else {
          return val;
        }
      }));
      doc.text('Reporte de Inventario', 14, 20);
      doc.autoTable({
        head: [headers],
        body: body,
        startY: 30,
        styles: { fontSize: 9 },
        columnStyles: {
          1: { halign: 'right' },
          2: { halign: 'right' },
          3: { halign: 'right' }
        }
      });
      doc.save('inventario.pdf');
    });
  </script>
</body>
</html>
